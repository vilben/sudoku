import{m as I,r as d,j as i,n as v,t as S,v as _,o as m,p as $,q as R}from"./main-BILHCHKe.js";import{B as p}from"./button-DZNkQJQ6.js";function B(o){return I({select:l=>l.location})}const g=d.createContext(void 0),w=()=>{const o=d.useContext(g);if(!o)throw new Error("SudokuContext is missing");return o},F=({rowIndex:o,colIndex:l,value:a,onChange:r,isDisabled:e,onFocus:s})=>{const{showErrors:t,errors:n}=w(),u=d.useCallback(()=>t&&!e&&n.find(c=>c.x===l&&c.y===o),[t,n]);return i.jsx("input",{className:`w-8 h-8 text-xl sm:w-12 sm:h-12 md:w-16 md:h-16 lg:w-22 lg:h-22 sm:text-2xl md:text-4xl lg:text-6xl box-border text-center border-2 font-bold border-sudoku-border ${u()&&"text-red-300"} ${e&&"bg-sudoku-background"}`,id:`cell-${o}${l}`,type:"text",inputMode:"numeric",autoComplete:"off",disabled:e,maxLength:1,value:a,onChange:r,onFocus:s})},N=()=>{const{grid:o,setCellValue:l,isInitial:a}=w(),[r,e]=d.useState(),s=(t,n,u)=>{const c=t.target.value;c.length>1||!/^[0-9]?$/.test(c)||l(n,u,Number(c))};return i.jsx(i.Fragment,{children:i.jsx("div",{id:"tanstack-sudoku",className:"inline-flex flex-col",children:o.map((t,n)=>i.jsx("div",{className:`flex flex-row w-auto ${n%3===0?"border-t-2 border-t-sudoku-outer-border ":""}${n%3===2?"border-b-2 border-b-sudoku-outer-border ":""}`,children:t.map((u,c)=>i.jsx("div",{className:`${c%3===0?"border-l-2 border-l-sudoku-outer-border ":""}${c%3===2?"border-r-2 border-r-sudoku-outer-border ":""}`,children:i.jsx(F,{rowIndex:n,colIndex:c,value:u===0?"":u.toString(),onChange:h=>s(h,n,c),onFocus:()=>{e({rowIndex:n,colIndex:c})},isDisabled:a(n,c,u)})},`${n}${c}`))},n))})})},G=()=>{const o=v(),[l]=d.useState(o.history.location.pathname),[a,r]=d.useState(o.history.location.state.__TSR_index),e=d.useCallback(()=>{o.history.back()},[o.history]),s=d.useCallback(()=>{o.history.forward(),o.history.location.state.__TSR_index>a&&r(o.history.location.state.__TSR_index)},[o.history.location.state.__TSR_index]),t=()=>{const c=o.history.location.state.__TSR_index;return c>a&&r(o.history.location.state.__TSR_index),c<a},n=d.useCallback(()=>o.history.location.pathname===l||!o.history.canGoBack(),[o.history.location]);return{isForwardDisabled:d.useCallback(()=>!t(),[t,o.history]),isBackwardDisabled:n,handleBackward:e,handleForward:s}},Z=()=>{const{isForwardDisabled:o,isBackwardDisabled:l,handleBackward:a,handleForward:r}=G();return i.jsxs(i.Fragment,{children:[i.jsx(p,{variant:"default",size:"icon",disabled:l(),onClick:a,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-undo-icon lucide-undo",children:[i.jsx("path",{d:"M3 7v6h6"}),i.jsx("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"})]})}),i.jsx(p,{variant:"default",size:"icon",disabled:o(),onClick:r,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-redo-icon lucide-redo",children:[i.jsx("path",{d:"M21 7v6h-6"}),i.jsx("path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"})]})})]})};function L(o){const a=r=>{const e=new Set;for(const s of r)if(s!==0){if(s<1||s>9||e.has(s))return!1;e.add(s)}return!0};for(let r=0;r<9;r++)if(!a(o[r]))return!1;for(let r=0;r<9;r++){const e=o.map(s=>s[r]);if(!a(e))return!1}for(let r=0;r<9;r+=3)for(let e=0;e<9;e+=3){const s=[];for(let t=0;t<3;t++)for(let n=0;n<3;n++)s.push(o[r+t][e+n]);if(!a(s))return!1}return!0}function M(o){const a=[],r=e=>{const s=new Map;for(const t of e)if(t.value!==0)if(t.value<1||t.value>9)a.push({x:t.x,y:t.y});else if(s.has(t.value)){const n=s.get(t.value);a.push(n,{x:t.x,y:t.y})}else s.set(t.value,{x:t.x,y:t.y})};for(let e=0;e<9;e++)r(o[e].map((s,t)=>({x:t,y:e,value:s})));for(let e=0;e<9;e++)r(o.map((s,t)=>({x:e,y:t,value:s[e]})));for(let e=0;e<9;e+=3)for(let s=0;s<9;s+=3){const t=[];for(let n=0;n<3;n++)for(let u=0;u<3;u++){const c=e+n,h=s+u;t.push({x:h,y:c,value:o[c][h]})}r(t)}return Array.from(new Map(a.map(e=>[`${e.x},${e.y}`,e])).values())}const H=()=>{const{grid:o,showErrors:l,setShowErrors:a}=w(),r=d.useCallback(()=>{const t=L(o);s(t),a(!t)},[o]),e=()=>{a(!1)},s=t=>{(t?S.success:S.error)(`Sudoku is ${t?"valid":"invalid"}`,{position:"top-right",cancel:{label:"Hide",onClick:()=>{}}})};return i.jsxs(i.Fragment,{children:[!l&&i.jsx(p,{variant:"default",onClick:r,children:"Check Errors"}),l&&i.jsx(p,{variant:"destructive",onClick:e,children:"Hide Errors"})]})},T=()=>i.jsxs("div",{className:"flex justify-center gap-4",children:[i.jsx(Z,{}),i.jsx(H,{})]});function D(o){const l=v();return a=>{const r=l.buildLocation({to:"/tanstack-sudoku/sudoku/$sudokuId/$sudokuProgress",params:{sudokuId:o,sudokuProgress:a}}).pathname;l.history.push(r)}}const P=o=>{const l=B();d.useEffect(()=>{const r=l.pathname.split("/"),e=r.at(-1),s=r.at(-2);if(!(!e||!s||e.length!==81||s.length!==81)&&_(s,e))try{const t=m(e);o(t)}catch(t){console.error(t)}},[l])};function V(o,l){const a=m(o),r=l?m(l):null,e=D(o),[s,t]=d.useState(r??a),[n,u]=d.useState(!1),[c,h]=d.useState([]);return P(t),d.useEffect(()=>{n&&h(M(s))},[s,n]),{grid:s,setCellValue:(x,f,k)=>{const b=s.map((y,C)=>y.map((E,j)=>C===x&&j===f?k:E));t(b),e($(b))},initialGrid:a,isInitial:(x,f,k)=>a[x][f]!==0&&a[x][f]===k,setGrid:t,showErrors:n,setShowErrors:u,errors:c}}const A=function(){const{sudokuId:l,sudokuProgress:a}=R.useParams(),{grid:r,setCellValue:e,isInitial:s,setGrid:t,errors:n,setShowErrors:u,showErrors:c}=V(l,a);return i.jsx("div",{className:"flex flex-col justify-center gap-2 p-2",children:i.jsxs(g,{value:{grid:r,setCellValue:e,isInitial:s,setGrid:t,showErrors:c,setShowErrors:u,errors:n},children:[i.jsx(T,{}),i.jsx(N,{})]})})};export{A as component};
